<!--
 * @Author: @ydzat
 * @Date: 2025-05-14 14:45:00
 * @LastEditors: @ydzat
 * @LastEditTime: 2025-05-15 16:30:00
 * @Description: KnowForge项目开发路线图
-->

# KnowForge项目后续开发路线图

## 当前发展阶段概述

KnowForge项目现处于早期发展阶段(0.1.4)，基础架构已经建立，核心功能逐步完善。截至目前已完成的主要工作包括：

1. **基础架构搭建** (0.1.0)：
   - 核心模块结构设计与实现
   - 多语言支持系统
   - 基础配置管理
   - 多源输入处理(PDF、网页链接、代码文件)
   - 命令行界面

2. **日志系统升级** (0.1.1)：
   - 集成Logloom日志系统
   - 实现日志国际化支持
   - 添加日志文件轮转功能

3. **向量记忆管理优化** (0.1.2)：
   - ChromaDB API兼容性修复
   - 混合检索策略增强
   - 阈值处理逻辑优化
   - 关键词匹配功能完善

4. **国际化系统更新** (0.1.3)：
   - 完全迁移LocaleManager至Logloom
   - 优化国际化资源加载机制
   - 实现键名智能解析功能
   - 建立通用国际化接口

5. **OCR-LLM-知识库集成** (0.1.4)：
   - 实现EmbeddingManager类，提供知识检索功能
   - 开发LLMCaller模块，支持DeepSeek和OpenAI API
   - 实现高级OCR处理流程，包括图像预处理
   - 集成知识库增强OCR结果的能力
   - 建立完整的OCR-LLM-知识库处理流水线

## 后续开发优先级

### 1. 短期目标 (0.1.4 - 0.1.6)

#### 1.1 继续完善OCR-LLM集成
- **优化当前实现**（当前进行中-0.1.4）:
  - 优化OCR图像预处理参数，提高识别准确率
  - 改进LLM提示模板，针对不同类型文档进行优化
  - 扩充知识库内容，提高专业领域文本识别质量
  - 提供用户友好的知识库管理工具
  - 改进置信度计算机制，提高结果可靠性

#### 1.2 文档综合处理（优先级提升）
- **PDF内容综合提取功能**（下一步开发-0.1.5）:
  - 实现DocumentAnalyzer，自动识别文档中的文本和图像区域
  - 实现ContentExtractor，提取文本和图像内容
  - 增强PDF解析器，识别文档结构（章节、段落、图表位置）
  - 将提取的图像通过现有OCR-LLM流程处理
  - 开发初步的内容整合功能，保持原始文档结构

- **表格与公式专项处理**（计划于0.1.6）:
  - 完善DocumentAnalyzer，添加表格和公式区域识别
  - 添加专门的表格识别与处理库(Camelot/tabula-py)
  - 实现数学公式OCR与LaTeX转换功能
  - 开发ContentProcessor处理不同类型内容

- **图片OCR能力进一步强化**（持续改进）:
  - 实现多语言OCR支持(中英文、公式识别)
  - 添加图像预处理(去噪、对比度增强)以提高OCR准确率
  - 开发图像分析能力，识别图表结构
  - 实现LLM辅助OCR结果纠错与增强机制

#### 1.3 LLM调用模块强化
- **DeepSeek模型调用优化**：
  - 添加更多模型选项(DeepSeek Chat/Reasoner)
  - 优化Prompt模板，提高生成质量
  - 实现上下文管理器，避免超长输入
  - 增加模型参数(temperature等)动态调整功能

#### 1.4 内容整合与输出格式扩展
- **内容整合与格式保留**（计划于0.1.7-0.2.0）:
  - 实现ContentIntegrator功能，整合不同类型内容
  - 确保在最终笔记中保留原始文档结构
  - 优化表格和公式在不同输出格式中的展示
  - 加强不同内容类型之间的上下文关联

- **丰富输出能力**：
  - 完善PDF生成(支持表格和公式渲染)
  - 优化Jupyter Notebook输出格式(支持交互式表格和LaTeX公式)
  - 添加HTML输出选项(支持响应式表格和MathJax公式)
  - 支持代码块语法高亮与格式化

#### 1.5 Web界面基础开发
- **提供简易Web操作界面**：
  - 基础文件上传与处理
  - 笔记预览与下载
  - 进度显示与状态反馈

#### 1.6 测试覆盖增强
- **完善测试体系**：
  - 为OCR与LLM调用添加模拟测试
  - 增强集成测试覆盖率
  - 开发端到端测试用例

### 2. 中期目标 (0.2.0 - 0.3.0)

#### 2.1 高级记忆管理功能
- **开发智能记忆管理策略**：
  - 上下文感知检索增强
  - 记忆分类与标签系统
  - 记忆优先级与遗忘机制

#### 2.2 用户界面开发
- **完备的Web界面**：
  - 项目管理功能
  - 交互式笔记编辑
  - 记忆库管理工具
  - 实时生成预览

#### 2.3 插件系统设计
- **开发可扩展插件系统**：
  - 定义标准插件接口
  - 支持第三方输入/输出处理器
  - 自定义主题与模板

#### 2.4 MoeAI-C系统集成
- **作为MoeAI-C的笔记生成子系统**：
  - 提供标准API接口
  - 支持组件间数据交换
  - 开发共享认证机制

### 3. 长期目标 (0.3.0+)

#### 3.1 高级多模态能力
- **处理更复杂的多模态输入**：
  - 图像深度语义理解（图表分析、可视化解读）
  - 音频转录与总结（仅长期规划，非核心功能）
  - 视频内容解析（仅长期规划，非核心功能）
  - 复杂科学文档处理（包含高级数学公式、专业图表）

#### 3.2 跨文档关联分析
- **基于大规模语料的知识图谱**：
  - 构建主题间关联网络
  - 提供知识探索界面

## 当前开发状态

### OCR-LLM-知识库集成 (0.1.4)

#### 已完成工作

1. **EmbeddingManager类实现**:
   - 创建了知识库检索能力
   - 实现了高效的向量嵌入管理
   - 添加了错误处理和日志记录
   - 开发了与MemoryManager的无缝集成

2. **LLMCaller模块开发**:
   - 支持DeepSeek和OpenAI API
   - 实现了重试逻辑和错误处理
   - 添加了自动API密钥轮换功能
   - 优化了请求参数和超时处理

3. **OCR-LLM-知识库测试验证**:
   - 验证了完整的OCR-LLM-知识库处理流水线
   - 编写了全面的测试和示例脚本

### 下一阶段重点：文档综合处理

经评估，为实现"用户无需手动划分文件类型"的目标，我们将在v0.1.5-v0.2.0阶段重点开发文档综合处理功能，包括：

1. **文档结构分析**:
   - 自动区分PDF文档中的文本、图片、表格和公式内容
   - 开发DocumentAnalyzer和ContentExtractor模块
   - 保留原文档结构信息用于后续整合

2. **专业内容处理**:
   - 表格识别与结构化处理
   - 数学公式识别与LaTeX转换
   - 特殊格式的保存与渲染

3. **内容整合机制**:
   - 按原始顺序和结构整合各类型内容
   - 确保不同内容类型之间的语义连贯性
   - 保证笔记输出的格式统一和结构完整
   - 实现了知识库内容管理工具

#### 测试结果与分析

测试结果显示OCR-LLM-知识库集成大幅提高了OCR的准确性和可用性:

1. **性能表现**:
   - 文本质量显著提升：在测试案例中，平均增加1200%的有效内容
   - 置信度提高：平均提高约25%
   - 识别准确率：特别是对专业术语和结构化内容的识别更加准确

2. **处理能力**:
   - 单图像处理平均耗时约20秒
   - LLM调用耗时约7-10秒
   - 知识库检索耗时约1-2秒
   - OCR预处理和识别耗时约3秒

3. **知识库依赖**:
   - 知识库内容质量直接影响最终输出
   - 领域特定知识对专业内容识别至关重要
   - 成功实现了知识库的内容动态更新

#### 使用指南与注意事项

1. **环境准备**:
   ```bash
   # 必须先激活conda环境
   conda activate knowforge
   
   # 设置API密钥
   export DEEPSEEK_API_KEY=your_api_key_here
   ```

2. **运行测试**:
   ```bash
   # 测试单一图像
   python scripts/ocr_llm_test.py --image input/images/test-note.png
   
   # 测试所有图像
   python scripts/ocr_llm_test.py --all
   ```

3. **知识库管理**:
   ```bash
   # 添加样本内容到知识库
   python scripts/add_to_knowledge_base.py --add-sample
   
   # 添加自定义内容
   python scripts/add_to_knowledge_base.py --add-content "您的内容" --source "来源" --topic "主题"
   ```

#### 下一步改进计划

1. **性能优化**:
   - 探索更高效的图像预处理方案
   - 实现批处理以提高多图像处理效率
   - 考虑本地LLM部署以减少API依赖

2. **功能增强**:
   - 开发更智能的OCR结果后处理
   - 设计专业领域适配的知识库管理策略
   - 添加用户反馈机制以改进模型效果

3. **用户体验**:
   - 提供Web界面展示OCR-LLM处理结果
   - 实现处理进度实时展示
   - 开发结果对比和审阅功能
  - 自动链接相关概念

#### 3.3 个性化笔记风格
- **适应不同学习风格的输出定制**：
  - 概念图解自动生成
  - 问答式笔记模板
  - 复习测验自动创建

## 技术债务管理计划

1. **记忆模块重构**：优化memory_manager代码组织，提高可维护性
2. **向量检索性能优化**：特别是针对大规模记忆库的查询性能
3. **测试覆盖率提升**：尤其针对最近修改的部分
4. **代码文档完善**：增加更详细的API文档和示例
5. **国际化模块优化**：解决现有问题，简化代码并提高可靠性

## 下一步具体行动计划

### 近期任务(优先级从高到低)

1. **完成国际化系统优化**（0.1.3版本收尾工作）
   - 解决格式化功能问题，确保所有键的正确格式化
   - 修复框架集成测试中的递归错误
   - 更新API文档，详细说明Logloom的使用方式
   - 制定长期迁移计划，逐步使用原生Logloom API

2. **实现图片OCR功能**（0.1.4版本核心功能）
   - 集成easyocr库，支持中英文识别
   - 添加图像预处理功能
   - 实现LLM辅助OCR结果纠错与增强
   - 编写测试用例

3. **优化LLM调用逻辑**
   - 增强Prompt工程，提升生成质量
   - 实现动态上下文窗口管理
   - 添加更多模型选项配置

4. **完善PDF输出功能**
   - 实现从Markdown到PDF的转换
   - 添加目录生成
   - 支持自定义样式

5. **开发基本Web界面**
   - 设计简洁的用户交互流程
   - 实现文件上传与结果展示
   - 添加基本进度显示功能

### 技术债务管理
1. **重构memory_manager模块**，进一步优化代码组织
2. **优化向量检索性能**，特别是针对大记忆库
3. **提升测试覆盖率**，尤其针对最近修改的部分

## 国际化系统优化详细计划

### 已完成工作

1. **LocaleManager完全迁移至Logloom**：
   - 移除了所有旧的实现代码和备用逻辑
   - 利用新版Logloom提供的API，如`register_locale_file`和`register_directory`
   - 实现了完全依赖Logloom的纯封装
   - 所有测试用例成功通过

2. **解决键名格式不一致问题**：
   - 实现了智能键名解析和缓存机制
   - 支持多种键格式，包括带语言前缀的键和不带前缀的简单键
   - 添加了键名映射功能，提高查找效率

3. **优化格式化参数处理**：
   - 增强了对默认值的处理
   - 改进了错误处理和日志记录机制

### 待解决问题

1. **格式化功能优化**：
   - 研究为什么某些键（如`system.error`）的格式化在测试中失败
   - 可能需要调整LocaleManager的实现或更新语言资源文件
   - 验证纯Python实现中的限制条件

2. **递归错误问题**：
   - 调查框架集成测试`test_framework_integration.py`中的递归错误
   - 分析错误栈跟踪，确定循环调用的具体位置
   - 检查与warnings处理相关的代码

3. **文档更新**：
   - 更新API文档，提供新接口的使用示例
   - 补充Logloom配置说明
   - 添加键名格式说明和最佳实践

4. **长期迁移计划**：
   - 制定分阶段策略，逐步在代码中直接使用Logloom API
   - 将LocaleManager标记为"已弃用"，为未来移除做准备
   - 提供迁移指南，帮助开发人员适应变更

### 实施步骤

1. **修复格式化功能**：
   - 分析`system.error`等键的格式和使用方式
   - 检查语言资源文件中的定义是否符合预期
   - 调整LocaleManager.format方法的实现，确保正确处理所有键格式

2. **解决递归错误**：
   - 使用断点调试或日志分析定位问题
   - 检查`input_handler.py`中的`_filter_pdf_warnings`函数
   - 实现循环检测机制，避免无限递归

3. **完成文档更新**：
   - 编写详细的API使用文档
   - 添加从LocaleManager迁移到直接使用Logloom的指南
   - 更新国际化相关的配置说明

4. **进行全面测试**：
   - 运行所有单元测试和集成测试
   - 创建特定测试场景验证修复结果
   - 检查性能和资源使用情况

## 结论

KnowForge项目已经建立了良好的基础架构，实现了核心功能的早期版本。通过持续迭代和模块增强，项目正朝着成为一个全功能的AI辅助学习笔记生成器的方向发展。最近完成的LocaleManager迁移工作是国际化系统优化的重要一步，接下来将解决剩余问题，并继续推进OCR功能开发。

后续开发应当保持模块化设计，遵循已建立的代码组织和国际化支持原则，同时不断完善文档和测试。根据功能优先级有序推进，保持较小的更新步伐，便于及时获取反馈并进行调整。